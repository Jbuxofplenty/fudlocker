!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";a.r(t);var i=window.awsLambdaWidget,n=i.React,r=i.PropTypes,s=i.awsUi,o=(i.locale,i.widget),l="$CREATE";function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),i.forEach(function(t){u(e,t,a[t])})}return e}function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function h(e,t,a,i,n,r,s){try{var o=e[r](s),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(i,n)}function p(){var e;return e=regeneratorRuntime.mark(function e(t,a){var i,n,r,s,u,h,p,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.data,n=t.persistedState,r=a.target,s=n.value,u=s.apiName,h=s.binaryMediaTypes,(p=n.value.api)!==l){e.next=8;break}return e.next=7,o.call("createRestApi",{apiName:u,binaryMediaTypes:h});case 7:p=e.sent;case 8:return d=r.split(":")[6],p="api-gateway/".concat(p,"/*/*/").concat(d),o.metrics.logEvent("apig_sec_".concat(i.security.toLowerCase())),h.filter(function(e){return!!e}).length>0&&o.metrics.logEvent("apig_bmt"),i.loggingAndMetrics&&o.metrics.logEvent("apig_lam"),e.abrupt("return",c({},i,{identifier:p}));case 14:case"end":return e.stop()}},e,this)}),(p=function(){var t=this,a=arguments;return new Promise(function(i,n){var r=e.apply(t,a);function s(e){h(r,i,n,s,o,"next",e)}function o(e){h(r,i,n,s,o,"throw",e)}s(void 0)})}).apply(this,arguments)}function d(e){return e.value.api===l?["apiName","stage","security","loggingAndMetrics","binaryMediaTypes"]:["stage","security"]}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),i.forEach(function(t){P(e,t,a[t])})}return e}function v(e,t,a,i,n,r,s){try{var o=e[r](s),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(i,n)}function m(e){return function(){var t=this,a=arguments;return new Promise(function(i,n){var r=e.apply(t,a);function s(e){v(r,i,n,s,o,"next",e)}function o(e){v(r,i,n,s,o,"throw",e)}s(void 0)})}}function b(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function M(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var E=s.AttributeEditor,O=s.Checkbox,T=s.ExpandableSection,k=s.FormField,A=s.Input,x=s.Select,C=function(e){function t(e){var a,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=M(this,S(t).call(this,e)),e.persistedState?i.state=e.persistedState:i.state={apis:[],stages:[],value:{binaryMediaTypes:[""],loggingAndMetrics:!1},validation:{}},o.onSubmit((a=i).submit.bind(a)),i}var a,i,r,s,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,n.Component),a=t,(i=[{key:"componentWillMount",value:(c=m(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setStateWithPersist(this.state),e.next=3,o.call("listRestApis");case 3:t=e.sent,this.setStateWithPersist({apis:t.map(function(e){return{id:e.value,label:e.text}})}),t.length||this.changeApi(l);case 6:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"setStateWithPersist",value:function(e,t){this.setState(e,t),this.props.persistState(e)}},{key:"getMessage",value:function(e){return this.props.data.config.getMessage(e)}},{key:"changeApi",value:function(e){var t=this;if(this.setStateWithPersist({value:y({},this.state.value,{api:e})}),e===l){var a={apiName:this.state.value.apiName||"".concat(this.props.data.target.split(":")[6]||"myFunction","-API"),stage:this.state.value.stage||"default"};this.setStateWithPersist({value:y({},this.state.value,a)})}else o.call("listStages",{apiId:e}).then(function(e){return t.setStateWithPersist({stages:e.map(function(e){return{id:e.value,label:e.text}})})});this.updateCreateValidity()}},{key:"handleApiChange",value:function(e){this.setStateWithPersist({validation:y({},this.state.validation,{api:void 0})}),this.changeApi(e.detail.selectedId)}},{key:"handleApiNameChange",value:function(e){var t=e.detail.value;this.setStateWithPersist({value:y({},this.state.value,{apiName:t})}),this.shallowlyValidate("apiName",t)}},{key:"handleStageChange",value:function(e){this.setStateWithPersist({value:y({},this.state.value,{stage:e})}),this.shallowlyValidate("stage",e)}},{key:"handleSecurityChange",value:function(e){var t=e.detail.selectedId;this.setStateWithPersist({value:y({},this.state.value,{security:t})}),this.shallowlyValidate("security",t)}},{key:"handleLoggingAndMetricsChange",value:function(e){var t=e.detail.checked;this.setStateWithPersist({value:y({},this.state.value,{loggingAndMetrics:t})})}},{key:"handleBinaryMediaTypeChange",value:function(e,t){var a=this.state.value.binaryMediaTypes.slice();a[t]=e,this.setStateWithPersist({value:y({},this.state.value,{binaryMediaTypes:a})})}},{key:"handleAddBinaryMediaType",value:function(){var e=f(this.state.value.binaryMediaTypes).concat([""]);this.setStateWithPersist({value:y({},this.state.value,{binaryMediaTypes:e})})}},{key:"handleRemoveBinaryMediaType",value:function(e){var t=this.state.value.binaryMediaTypes.slice();t.splice(e.detail.itemIndex,1),this.setStateWithPersist({value:y({},this.state.value,{binaryMediaTypes:t})})}},{key:"submit",value:(s=m(regeneratorRuntime.mark(function e(t){var a,i,n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.state.value.api,i=d(this.state).reduce(function(e,t){return y({},e,P({},t,r.state.value[t]))},{}),a){e.next=6;break}return this.setStateWithPersist({validation:y({},this.state.validation,{api:this.getMessage("validation.api.required")})}),t(null,{valid:!1,data:y({identifier:a},i)}),e.abrupt("return");case 6:n=this.fullyValidate(i),t(null,{valid:n,data:y({identifier:a},i)});case 8:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"fullyValidate",value:function(e){var t=this.props.data.config,a=t.getValidatorForSchema(t["x-api-schema"]),i=Object.keys(e),n=a.validate(e).errors.filter(function(e){return"required"===e.keyword}).map(function(e){return{field:e.params.missingProperty,message:e.message}}).filter(function(e){var t=e.field;return i.includes(t)}).reduce(function(e,t){return y({},e,P({},t.field,t.message))},{});return this.setStateWithPersist({validation:y({},this.state.validation,n)},this.updateCreateValidity),!Object.keys(n).length}},{key:"shallowlyValidate",value:function(e,t){var a,i=this.props.data.config,n=i.getValidatorForSchema(i["x-api-schema"].properties[e]).validate(t),r=n.valid,s=n.errors;r||(a=s[0].message),this.setStateWithPersist({validation:y({},this.state.validation,P({},e,a))},this.updateCreateValidity)}},{key:"updateCreateValidity",value:function(){var e=this,t=d(this.state).reduce(function(t,a){return t&&!e.state.validation[a]},!0)&&!!this.state.value.api;o.change({valid:t,data:{identifier:this.state.value.api}})}},{key:"render",value:function(){var e=this,t=this.state.value,a=t.api,i=t.apiName,r=t.stage,s=t.security,o=t.loggingAndMetrics,c=t.binaryMediaTypes,u=["AWS_IAM","NONE","NONE_KEY"].map(function(t){return{id:t,label:e.getMessage("schema.security.".concat(t))}}),h=n.createElement(k,{label:this.getMessage("schema.security.name"),description:this.getMessage("schema.security.description"),hintText:s?this.props.data.config.formatMessage("ui.alert.security.".concat(s)):"",errorText:this.state.validation.security},n.createElement(x,{selectedId:s,options:u,onChange:this.handleSecurityChange.bind(this)})),p=null;if(a===l){var d={control:function(t,a){return n.createElement(A,{value:t,placeholder:"image/png",onInput:function(t){return e.handleBinaryMediaTypeChange(t.detail.value,a)}})}};p=n.createElement("span",null,h,n.createElement(T,{header:this.getMessage("ui.additionalSettings")},n.createElement(k,{label:this.getMessage("schema.apiName.name"),description:this.getMessage("schema.apiName.description"),errorText:this.state.validation.apiName},n.createElement(A,{value:i,onInput:this.handleApiNameChange.bind(this)})),n.createElement(k,{label:this.getMessage("schema.stage.name"),description:this.getMessage("schema.stage.description"),errorText:this.state.validation.stage},n.createElement(A,{value:r,onInput:function(t){return e.handleStageChange(t.detail.value)}})),n.createElement(k,{label:this.getMessage("schema.cors.name"),description:this.props.data.config.formatMessage("schema.cors.description")}),n.createElement(k,null,n.createElement(O,{checked:o,label:this.getMessage("schema.loggingAndMetrics.name"),description:this.props.data.config.formatMessage("schema.loggingAndMetrics.description"),onChange:this.handleLoggingAndMetricsChange.bind(this)})),n.createElement(k,{label:this.getMessage("schema.binaryMediaTypes.name"),description:this.props.data.config.formatMessage("schema.binaryMediaTypes.description")}),n.createElement(E,{addButtonText:this.getMessage("ui.button.binaryMediaTypes.add"),removeButtonText:this.getMessage("ui.button.binaryMediaTypes.remove"),definition:[d],items:c||[],onAddButtonClick:this.handleAddBinaryMediaType.bind(this),onRemoveButtonClick:this.handleRemoveBinaryMediaType.bind(this)})))}else a&&(p=n.createElement("span",null,n.createElement(k,{label:this.getMessage("schema.stage.name"),description:this.getMessage("schema.stage.description"),errorText:this.state.validation.stage},n.createElement(x,{selectedId:r,options:this.state.stages,onChange:function(t){return e.handleStageChange(t.detail.selectedId)},enableFiltering:!0})),h));var g=[{id:l,label:this.getMessage("schema.api.newApi")},{label:this.getMessage("schema.api.existingApis"),options:this.state.apis}];return n.createElement("div",null,n.createElement("p",null,this.props.data.config.formatMessage("ui.blurb")),n.createElement(k,{label:this.getMessage("schema.identifier.name"),description:this.getMessage("schema.api.description"),errorText:this.state.validation.api},n.createElement(x,{selectedId:a,options:g,onChange:this.handleApiChange.bind(this),enableFiltering:!0})),p)}}])&&b(a.prototype,i),r&&b(a,r),t}();P(C,"propTypes",{data:r.object.isRequired,persistedState:r.object,persistState:r.func.isRequired}),o.register({id:"api-gateway",component:C,beforeCreate:function(e,t){return p.apply(this,arguments)}})}]);